<p align="center">
  <img src="https://github.com/user-attachments/assets/81cdbc21-3b92-4116-b04c-4a746beb3e53" height="250">
</p>

<h1 align="center">
    Kryptonite ML Challenge<br>
    –ö–æ–º–∞–Ω–¥–∞ MMG
</h1>

<br>

## üìù –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

<ol type="I">
  <li>
    <b>–®–∞–ø–∫–∞</b>
    <ul>
      <li><a href="#description">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</a></li>
      <li><a href="#demo">–î–µ–º–æ</a></li>
      <li><a href="#links">–°—Å—ã–ª–∫–∏</a></li>
      <li><a href="#data">–î–∞–Ω–Ω—ã–µ</a></li>
    </ul>
  </li>
  <li>
    <b>–ü—Ä–æ–µ–∫—Ç</b>
    <ul>
      <li><a href="#report">–û—Ç—á–µ—Ç</a></li>
      <li><a href="#tech-stack">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫</a></li>
      <li><a href="#project-structure">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</a></li>
    </ul>
  </li>
  <li>
    <b>–£—Å—Ç–∞–Ω–æ–≤–∫–∞</b>
    <ul>
      <li><a href="#cloning">–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a></li>
      <li><a href="#local">–ó–∞–ø—É—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ</a></li>
      <li><a href="#container">–ó–∞–ø—É—Å–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ</a></li>
    </ul>
  </li>
  <li>
    <b>–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤</b>
    <ul>
      <li><a href="#inference">–ò–Ω—Ñ–µ—Ä–µ–Ω—Å</a></li>
      <li><a href="#inference-page">–ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –≤–µ–±-—Å–∞–π—Ç–µ</a></li>
      <li><a href="#training">–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π</a></li>
      <li><a href="#new-dataset">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞</a></li>
      <li><a href="#clean-dataset">–û—Ç—á–∏—Å—Ç–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞</a></li>
      <li><a href="#onnx">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ onnx</a></li>
    </ul>
  </li>
  <li>
    <b>–ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ</b>
    <ul>
      <li><a href="#scaling">–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</a></li>
    </ul>
  </li>
</ol>

<a id="description"></a>
## üßê –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
–ü–æ–¥–¥–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–∏–¥–µ–æ, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ DeepFake, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —É–≥—Ä–æ–∑—É –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏, —á—Ç–æ –∏—Ö —Å–ª–æ–∂–Ω–æ –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç –Ω–∞—Å—Ç–æ—è—â–∏—Ö.

–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ —É–º–µ—Ç—å:

* –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —á–µ–ª–æ–≤–µ–∫–∞
* –†–∞–∑–ª–∏—á–∞—Ç—å —Å–Ω–∏–º–∫–∏ —Ä–∞–∑–Ω—ã—Ö –ª—é–¥–µ–π
* –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ñ–∞–ª—å—à–∏–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é DeepFake-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø—É—Ñ–∏–Ω–≥–∞

<a id="demo"></a>
## üé• –î–µ–º–æ
–î–µ–º–æ —Ä–µ—à–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ —Å GeForce GTX 960M (2015–≥), –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ [—Ç—É—Ç](http://5.35.46.26:14500)

–ú—ã –ø–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å 100% uptime –Ω–∞ –ø–µ—Ä–∏–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ö–∞–∫–∞—Ç–æ–Ω–∞, –æ–¥–Ω–∞–∫–æ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π —á–∞—Å—Ç—å—é.

<div align="center">
  <img src="https://github.com/user-attachments/assets/1b655ab0-f6b3-480c-bc7f-4e3fc93a1b07" alt="demo" width="100%">
</div>

<a id="links"></a>
## üîó –°—Å—ã–ª–∫–∏
**–õ–µ–Ω–¥–∏–Ω–≥:** [kryptonite-ml.ru](https://kryptonite-ml.ru)  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** [git.codenrock.com/kryptonite-ml-challenge-1347](https://git.codenrock.com/kryptonite-ml-challenge-1347)  
**–¢–µ—Å—Ç–∏—Ä—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞:** [codenrock.com/contests/kryptonite-ml-challenge](https://codenrock.com/contests/kryptonite-ml-challenge)

<a id="data"></a>
## üìÅ –î–∞–Ω–Ω—ã–µ
–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∏—Ö –≤ –ø–∞–ø–∫–µ `data`. 

- **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è:** [–°–∫–∞—á–∞—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ](https://storage.codenrock.com/companies/codenrock-13/contests/kryptonite-ml-challenge/train.zip)
- **–û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è:** [–°–∫–∞—á–∞—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ](https://drive.google.com/file/d/193Vi9JBxdfLlV32nrw8hb-rls4BTpIkU/view?usp=sharing)
- **–î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ—Ç—Ä–µ–π–Ω–∞:** [–°–∫–∞—á–∞—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ](https://drive.google.com/file/d/1muyIwX8c35Bl0OQTfmETGVjBevk3S6CK/view?usp=sharing)
- **–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞:** [–°–∫–∞—á–∞—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ](https://storage.codenrock.com/companies/codenrock-13/contests/kryptonite-ml-challenge/test_public.zip)

<a id="report"></a>
## üìÑ –û—Ç—á—ë—Ç
–û—Ç—á—ë—Ç –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Ñ–∞–π–ª–µ [Research-Report-MMG.pdf](Research-Report-MMG.pdf).

–í –Ω—ë–º –æ–ø–∏—Å–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ –≤—Å–µ–π —Ä–∞–±–æ—Ç–µ –∏ –Ω–∞—à–∏ —É–º–æ–∑–∫–ª—é—á–µ–Ω–∏—è.

<a id="tech-stack"></a>
## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **–°–∏—Å—Ç–µ–º–∞:** Ubuntu 22.04
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏:** Docker
- **–°–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:** conda, pip
- **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:** Python 3.12.0
- **–ì–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ:** PyTorch
- **–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏:** Transformers, TorchVision, OpenCV, NumPy, SciPy, timm
- **–í–µ–±-—Å–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è:** HTML, CSS, JavaScript, FastAPI, Uvicorn
- **–≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å:** ONNX Runtime
- **CLI –∏ —É—Ç–∏–ª–∏—Ç—ã:** argparse, tqdm

<a id="project-structure"></a>
## üìë –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```nushell
.
‚îú‚îÄ‚îÄ aligner <----------------------------- –ú–æ–¥—É–ª—å –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ª–∏—Ü
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ aligners
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ config.json <--------------------- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ pretrained_model <---------------- –¢—É—Ç –ª–µ–∂–∏—Ç –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ model.yaml
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ wrapper.py <---------------------- –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º–æ–¥–µ–ª—å—é –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ data <-------------------------------- –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ test_public
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ train
‚îú‚îÄ‚îÄ models <------------------------------ –ú–æ–¥–µ–ª–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ checkpoints <--------------------- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –æ–±—É—á–µ–Ω–∏—è
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ pretrained <---------------------- –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ onnx <---------------------------- –ú–æ–¥–µ–ª–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ONNX
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ download_pretrained_models.py <--- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ scripts <----------------------------- –†–∞–∑–ª–∏—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ convert.py <---------------------- –°–∫—Ä–∏–ø—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π –≤ ONNX
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ inference.py <-------------------- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ utils <--------------------------- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ net.py <---------------------- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ utils.py <-------------------- –£—Ç–∏–ª–∏—Ç—ã –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ train <------------------------------- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ align.py <------------------------ –°–∫—Ä–∏–ø—Ç –¥—è–ª –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (alignment, resize)
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ generate_pairs.py <--------------- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä –¥–ª—è —Ç—Ä–µ–π–Ω–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ train.py <------------------------ –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ leaderboard.ipynb <--------------- –û—Ü–µ–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ compute_similarities.py <--------- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥—á—ë—Ç–∞ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –≤ –ø–∞–ø–∫–∞—Ö
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ clean_data.py <------------------- –ê–ª–≥–æ—Ä–∏—Ç–º —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ—á–∏—â–µ–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
‚îú‚îÄ‚îÄ notebooks
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ embeding_visualization.ipynb <---- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–∏–Ω–≥–æ–≤
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ model-attack.ipynb <-------------- –ê—Ç–∞–∫–∏ –Ω–∞ –º–æ–¥–µ–ª—å
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ <---------------
‚îú‚îÄ‚îÄ web <--------------------------------- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ main.py <------------------------- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ static <-------------------------- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ       ‚îú‚îÄ‚îÄ images
‚îÇ       ‚îú‚îÄ‚îÄ index.html
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ submissions <------------------------- –ü–∞–ø–∫–∞ –¥–ª—è —Å–∞–±–º–∏—Ç–æ–≤
‚îú‚îÄ‚îÄ Research-Report-MMG.pdf <------------- PDF –û—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏
‚îú‚îÄ‚îÄ Presentation-MMG.pdf <---------------- –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.yaml <----------------- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è docker-compose
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ environment.yml <--------------------- –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Conda
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ README.md <--------------------------- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
‚îú‚îÄ‚îÄ .dockerignore
‚îî‚îÄ‚îÄ .gitignore
```

<a id="cloning"></a>
## üìã –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```nushell
git clone https://github.com/kekwak/Kryptonite-ML-Challenge.git
cd Kryptonite-ML-Challenge
```

<a id="local"></a>
## üíª –ó–∞–ø—É—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–Ω–∞–∫–æ–Ω–¥–∞.

*–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —ç—Ç–∏–º —Å–ø–æ—Å–æ–±–æ–º –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

```nushell
conda env create -f environment.yml && conda activate krypto
conda install conda-forge::onnxruntime
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu126 --force-reinstall
pip3 install numpy==2.2.3
```

<a id="container"></a>
## üê≥ –ó–∞–ø—É—Å–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
–°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∞–º–æ–º—É:
```nushell
docker compose run --rm -it --service-ports app
```
*–ù–∞ –¥–∞–Ω–Ω–æ–º —à–∞–≥–µ –ø—Ä–∏–¥–µ—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å...

–ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—Å–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è, –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ä–µ–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤:
```nushell
conda activate krypto
```
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

<a id="inference"></a>
## üöÄ –ò–Ω—Ñ–µ—Ä–µ–Ω—Å

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å —Å –≥—É–≥–ª –¥–∏—Å–∫–∞. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `--all`:
```nushell
python3 models/download_pretrained_models.py
```

–ü—É–±–ª–∏—á–Ω—ã–π –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –ø–∞–ø–∫–µ **data**, –≤–æ—Ç —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:
```nushell
data
‚îî‚îÄ‚îÄ test_public
   ‚îî‚îÄ‚îÄ images
       ‚îú‚îÄ‚îÄ 00000000
       ‚îÇ   ‚îú‚îÄ‚îÄ 0.jpg
       ‚îÇ   ‚îî‚îÄ‚îÄ 1.jpg
       ‚îú‚îÄ‚îÄ 00000001
       ‚îÇ   ‚îú‚îÄ‚îÄ 0.jpg
       ‚îÇ   ‚îî‚îÄ‚îÄ 1.jpg
       ‚îú‚îÄ‚îÄ ...
       ...
```

–ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å—É. –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:
```nushell
python3 scripts/inference.py --model models/onnx/ckpt_epoch1_batch6100_acc0.9831_eer0.0165.onnx
```
–í –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å, –Ω–æ —Ç–∞–∫–∂–µ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥—É—é –ø–∞–ø–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —Å –ø–æ–º–æ—â—å—é –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `--input_dir data/path/to/images`.

*–í –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [aligner](https://huggingface.co/minchul/cvlface_DFA_resnet50) –¥–ª—è –æ–±—Ä–µ–∑–∞–Ω–∏—è –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

<a id="inference-page"></a>
## üåê –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –≤–µ–±-—Å–∞–π—Ç–µ

–°–∫–∞—á–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –≥—É–≥–ª –¥–∏—Å–∫–∞:
```nushell
python3 models/download_pretrained_models.py --all
```

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `web` –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–µ—Ä–≤–µ—Ä:
```nushell
cd web && python3 -m uvicorn main:app --host 0.0.0.0 --port 8000
```
–í–µ–±-—Å—Ç—Ä–∞–Ω–∏—á–∫–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å—Å—ã–ª–∫–µ [0.0.0.0:8000](http://0.0.0.0:8000).

<a id="training"></a>
## üìö –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –æ–±—É—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –≤—Å–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –≥—É–≥–ª –¥–∏—Å–∫–∞. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º `--all`:
```nushell
python3 models/download_pretrained_models.py --all
```
–£–∂–µ —Å–∫–∞—á–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—à—É—Ç—Å—è.

–û–±—É—á–∞—é—â–∏–π –¥–∞—Ç–∞—Å–µ—Ç –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –ø–∞–ø–∫–µ **data**, –≤–æ—Ç —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:
```nushell
data
‚îî‚îÄ‚îÄ train
   ‚îú‚îÄ‚îÄ meta.json
   ‚îî‚îÄ‚îÄ images
       ‚îú‚îÄ‚îÄ 00000000
       ‚îÇ   ‚îú‚îÄ‚îÄ 0.jpg
       ‚îÇ   ‚îú‚îÄ‚îÄ 1.jpg
       ‚îÇ   ‚îî‚îÄ‚îÄ ...
       ‚îú‚îÄ‚îÄ 00000001
       ‚îÇ   ‚îú‚îÄ‚îÄ 0.jpg
       ‚îÇ   ‚îú‚îÄ‚îÄ 1.jpg
       ‚îÇ   ‚îî‚îÄ‚îÄ ...
       ‚îú‚îÄ‚îÄ ...
       ...
```

–ü–æ—Å–ª–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã—Ä–æ–≤–Ω—è—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω—É–∂–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:
```nushell
python3 train/align.py
```

–ó–∞–ø—É—Å–∫–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```nushell
python3 train/generate_pairs.py
```

–í–∞–∂–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ –∫–æ –≤—Å–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–∞–º –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—É—é—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –≤—ã–∑–≤–∞—Ç—å –µ—ë –º–æ–∂–Ω–æ –ø—Ä–∏ –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫:
```nushell
python3 train/generate_pairs.py --help
```
```nushell
usage: generate_pairs.py [-h] [--meta_path META_PATH] [--images_root IMAGES_ROOT] [--train_split TRAIN_SPLIT] [--output_train OUTPUT_TRAIN] [--output_val OUTPUT_VAL]

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è train –∏ val –Ω–∞–±–æ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ meta.json –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

options:
  -h, --help            show this help message and exit
  --meta_path META_PATH
                        –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É meta.json
  --images_root IMAGES_ROOT
                        –ü—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  --train_split TRAIN_SPLIT
                        –î–æ–ª—è –ª—é–¥–µ–π, –æ—Ç–≤–µ–¥—ë–Ω–Ω–∞—è –ø–æ–¥ train (–æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äì val)
  --output_train OUTPUT_TRAIN
                        –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è CSV —Ñ–∞–π–ª–∞ —Å train –ø–∞—Ä–∞–º–∏
  --output_val OUTPUT_VAL
                        –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è CSV —Ñ–∞–π–ª–∞ —Å val –ø–∞—Ä–∞–º–∏
```
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç—Ä–µ–±—É–µ–º—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞, —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–ö–æ–≥–¥–∞ –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Å–∞–º–æ–º—É –æ–±—É—á–µ–Ω–∏—é, –æ–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–∞–∫:
```nushell
python3 train/train.py
```

–û—Ü–µ–Ω–∫—É –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ wandb.

–î–ª—è –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª–∏–∫ [leaderboard.ipynb](train/leaderboard.ipynb).

–í—ã–±–æ—Ä –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ EER –Ω–∞ 1-2–π —ç–ø–æ—Ö–∞—Ö –æ–±—É—á–µ–Ω–∏—è.

–õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤:
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –æ–Ω–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ç–æ–ø-5 —Ö–æ—Ç—è –±—ã –ø–æ –æ–¥–Ω–æ–π –º–µ—Ç—Ä–∏–∫–µ
- —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å —ç—Ç–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `leaderboard.csv`

<a id="new-dataset"></a>
## üì¶ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

–í —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∏—Ç—å –±–∞–∑–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç –Ω–∞ –∫–∞–∫–æ–π-–ª–∏–±–æ –¥—Ä—É–≥–æ–π, –ø—Ä–∏–¥—ë—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—Å–µ —à–∞–≥–∏ –∏–∑ <a href="#training">–æ–±—É—á–µ–Ω–∏—è</a>, –∫—Ä–æ–º–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

–ú—ã –≤–æ–∑—å–º—ë–º –æ—á–∏—â–µ–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –∏–∑ —Å–µ–∫—Ü–∏–∏ <a href="#data">–¥–∞–Ω–Ω—ã—Ö</a>, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –æ–±—É—á–∞–ª–∞—Å—å –Ω–∞—à–∞ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å.

–°–∫–∞—á–∏–≤–∞–µ–º –µ–≥–æ –ø–æ —Å—Å—ã–ª–∫–µ –∏ —Ä–∞–∑–º–µ—â–∞–µ–º –µ–≥–æ —Ç–∞–∫–∏–º –∂–µ –æ–±—Ä–∞–∑–æ–º –∫–∞–∫ –∏ train –¥–∞—Ç–∞—Å–µ—Ç.

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –Ω—ë–º –±—ã–ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã, –ø–æ—ç—Ç–æ–º—É —à–∞–≥ —Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–ø—É—Å–∫–∞–µ–º

–í –∏–Ω–æ–º —Å–ª—É—á–∞–µ, –∫ `python3 train/align.py` –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äì –ø—É—Ç—å –¥–æ –ø–∞–ø–∫–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏, –∫ –ø—Ä–∏–º–µ—Ä—É `--input_dir data/train/images_new_data`.

–ü–æ–¥—Å–∫–∞–∑–∫–∞:
```nushell
python3 train/align.py --help
```
```nushell
usage: align.py [-h] [--input_dir INPUT_DIR] [--output_dir OUTPUT_DIR]

–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã—Ö –∫–æ–ø–∏–π.

options:
  -h, --help            show this help message and exit
  --input_dir INPUT_DIR
                        –ü—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
  --output_dir OUTPUT_DIR
                        –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—ã, –≤—ã–≤–µ–¥–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É:
```nushell
python3 train/generate_pairs.py --help
```
```nushell
usage: generate_pairs.py [-h] [--meta_path META_PATH] [--images_root IMAGES_ROOT]
                         [--train_split TRAIN_SPLIT] [--output_train OUTPUT_TRAIN]
                         [--output_val OUTPUT_VAL]

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è train –∏ val –Ω–∞–±–æ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ meta.json –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

options:
  -h, --help            show this help message and exit
  --meta_path META_PATH
                        –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É meta.json
  --images_root IMAGES_ROOT
                        –ü—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  --train_split TRAIN_SPLIT
                        –î–æ–ª—è –ª—é–¥–µ–π, –æ—Ç–≤–µ–¥—ë–Ω–Ω–∞—è –ø–æ–¥ train (–æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äì val)
  --output_train OUTPUT_TRAIN
                        –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è CSV —Ñ–∞–π–ª–∞ —Å train –ø–∞—Ä–∞–º–∏
  --output_val OUTPUT_VAL
                        –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è CSV —Ñ–∞–π–ª–∞ —Å val –ø–∞—Ä–∞–º–∏
```

–ò —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ, —É–∫–∞–∑–∞–≤ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```nushell
python3 train/generate_pairs.py \
    --meta_path data/train/meta_filtered.json \
    --images_root data/train/images_aligned_filtered \
    --output_train data/train/train_pairs_filtered.csv \
    --output_val data/train/val_pairs_filtered.csv
```

–û—Ç–ª–∏—á–Ω–æ! –ö–æ–¥–∞ –ø–∞—Ä—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é.

–¢–∞–∫–∏–º –∂–µ –æ–±—Ä–∞–∑–æ–º —É–∫–∞–∂–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è `train.py`.

–ü–æ–¥—Å–∫–∞–∑–æ—á–∫–∞:
```nushell
python3 train/train.py --help
```
```nushell
usage: train.py [-h] [--checkpoint CHECKPOINT] [--train_csv TRAIN_CSV] [--val_csv VAL_CSV]
                [--epochs EPOCHS] [--batch_size BATCH_SIZE]
                [--learning_rate LEARNING_RATE]
                [--checkpoint_interval CHECKPOINT_INTERVAL] [--s S]
                [--base_margin BASE_MARGIN] [--dynamic_scale DYNAMIC_SCALE]
                [--weight_decay WEIGHT_DECAY] [--architecture ARCHITECTURE]

–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ AdaFace —Å CSV-–¥–∞—Ç–∞—Å–µ—Ç–æ–º –∏ Adaptive Margin Loss.

options:
  -h, --help            show this help message and exit
  --checkpoint CHECKPOINT
                        –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —á–µ–∫–ø–æ–∏–Ω—Ç–∞ –º–æ–¥–µ–ª–∏.
  --train_csv TRAIN_CSV
                        –ü—É—Ç—å –∫ CSV —Ñ–∞–π–ª—É —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–∏.
  --val_csv VAL_CSV     –ü—É—Ç—å –∫ CSV —Ñ–∞–π–ª—É —Å –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–∏.
  --epochs EPOCHS       –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö –æ–±—É—á–µ–Ω–∏—è.
  --batch_size BATCH_SIZE
                        –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.
  --learning_rate LEARNING_RATE
                        –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞.
  --checkpoint_interval CHECKPOINT_INTERVAL
                        –ò–Ω—Ç–µ—Ä–≤–∞–ª (–≤ –±–∞—Ç—á–∞—Ö) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤.
  --s S                 –ü–∞—Ä–∞–º–µ—Ç—Ä –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Adaptive Margin Loss.
  --base_margin BASE_MARGIN
                        –ë–∞–∑–æ–≤—ã–π margin –¥–ª—è Adaptive Margin Loss.
  --dynamic_scale DYNAMIC_SCALE
                        –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π scale –¥–ª—è Adaptive Margin Loss.
  --weight_decay WEIGHT_DECAY
                        Weight decay –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞.
  --architecture ARCHITECTURE
                        –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏: 'ir_101' –∏–ª–∏ –¥—Ä—É–≥–∞—è.
```

–ê –≤–æ—Ç —Ç–∞–∫ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–∞–º–æ –æ–±—É—á–µ–Ω–∏–µ:
```nushell
python3 train/train.py \
    --train_csv data/train/train_pairs_filtered.csv \
    --val_csv data/train/val_pairs_filtered.csv
```

–î–∞–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—á—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–î–æ–ª–∂–Ω–æ –≤—ã–π—Ç–∏ —á—Ç–æ-—Ç–æ –ø–æ—Ö–æ–∂–µ–µ:

![image_2025-03-09_19-13-22](https://github.com/user-attachments/assets/96183615-4b56-4771-b77a-34b8b12f718b)

<a id="clean-dataset"></a>
## üßπ –û—Ç—á–∏—Å—Ç–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞

–ê —Ç–µ–ø–µ—Ä—å –æ —Å–∞–º–æ–π –æ—Ç—á–∏—Å—Ç–∫–µ –¥–∞—Ç–∞—Å–µ—Ç–∞.

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏, –º—ã —Å–æ—Å—Ç–∞–≤–∏–ª–∏ 2 —Å–∫—Ä–∏–ø—Ç–∞.

- train/compute_similarities.py ‚Äì —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥—á—ë—Ç–∞ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –≤ –ø–∞–ø–∫–∞—Ö
- train/clean_data.py ‚Äì –∞–ª–≥–æ—Ä–∏—Ç–º —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ—á–∏—â–µ–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

–°—á–∏—Ç–∞–µ–º —Å—Ö–æ–¥—Å—Ç–≤–æ:
```nushell
python3 train/compute_similarities.py
```

–í –ø–∞–ø–∫—É data —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ñ–∞–π–ª cosine_similarity_results.npz.

–î–∞–ª–µ–µ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç—á–∏—Å—Ç–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞:
```
python3 train/clean_data.py
```

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –≥—Ä–∞—Ñ–æ–≤–æ–π –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É.

–ü–æ—Å–ª–µ –¥–∞—Ç–∞—Å–µ—Ç –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫.

<a id="onnx"></a>
## üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ onnx

–î–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤ onnx —Ñ–æ—Ä–º–∞—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É:
```nushell
python3 scripts/convert.py --checkpoint path/to/model.ckpt --output_model path/to/onnx_model.onnx
```

<a id="scaling"></a>
## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö DeepFake –∏ FaceSwap –º–æ–¥–µ–ª–µ–π
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ–º–æ—â—å—é —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
